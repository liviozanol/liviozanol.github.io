<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Livio&#39;s Dump RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Livio&#39;s Dump Atom Feed"><title data-rh="true">Non-contiguous Netmasks | Livio&#x27;s Dump</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://livio.zanol.com.br/non-contiguous-netmasks"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Non-contiguous Netmasks | Livio&#x27;s Dump"><meta data-rh="true" name="description" content="Intro"><meta data-rh="true" property="og:description" content="Intro"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-05-20T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/liviozanol"><meta data-rh="true" property="article:tag" content="network fundamentals,subnet,iptables,acl,routing,pf"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://livio.zanol.com.br/non-contiguous-netmasks"><link data-rh="true" rel="alternate" href="https://livio.zanol.com.br/non-contiguous-netmasks" hreflang="en"><link data-rh="true" rel="alternate" href="https://livio.zanol.com.br/non-contiguous-netmasks" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.bd4424da.css">
<link rel="preload" href="/assets/js/runtime~main.fd840988.js" as="script">
<link rel="preload" href="/assets/js/main.75488faf.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/lzp-small.svg" alt="Logo" class="themedImage_W2Cr themedImage--light_TfLj" height="32" width="32"><img src="/img/lzp-small.svg" alt="Logo" class="themedImage_W2Cr themedImage--dark_oUvU" height="32" width="32"></div><b class="navbar__title text--truncate">Livio&#x27;s Dump</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">All Blog Posts</a><a href="https://github.com/liviozanol" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="mailto:livio@zanol.com.br" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">E-mail: livio@zanol.com.br<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_dLyj"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_TMXw thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_V4zb margin-bottom--md">All posts</div><ul class="sidebarItemList_uHd5 clean-list"><li class="sidebarItem_spIe"><a aria-current="page" class="sidebarItemLink_eqrF sidebarItemLinkActive_XZSJ" href="/non-contiguous-netmasks">Non-contiguous Netmasks</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/vmware-vds-traffic-filter">Using vSphere Distributed Switch (VDS) for stateless &quot;traffic filtering&quot; (or ACL)</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/full-stack-it-automation-part-11">Full-Stack Automation Part 11 - Conclusions</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/full-stack-it-automation-part-10-demo-ui">Full-Stack Automation Part 10 - Demo - UI</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/full-stack-it-automation-part-9-demo-api">Full-Stack Automation Part 9 - Demo - API</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/full-stack-it-automation-part-8-demo-gitlab-runner">Full-Stack Automation Part 8 - Demo - Runner</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/full-stack-it-automation-part-7-demo-awx">Full-Stack Automation Part 7 - Demo - AWX</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/full-stack-it-automation-part-6-demo-scenario">Full-Stack Automation Part 6 - Demo -Scenario</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/full-stack-it-automation-part-5-gitlabci">Full-Stack Automation Part 5 - Gitlab CI</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/full-stack-it-automation-part-4-awx">Full-Stack Automation Part 4 - AWX</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/full-stack-it-automation-part-3-Vault">Full-Stack Automation Part 3 - Vault</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/full-stack-it-automation-part-2-gitlab">Full-Stack Automation Part 2 - Gitlab</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/full-stack-it-automation-part-1">Full-Stack Automation Part 1 - Overview</a></li><li class="sidebarItem_spIe"><a class="sidebarItemLink_eqrF" href="/first">First Post</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_rzP5" itemprop="headline">Non-contiguous Netmasks</h1><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-05-20T00:00:00.000Z" itemprop="datePublished">May 20, 2022</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://github.com/liviozanol" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/liviozanol.png" alt="Lívio Zanol Puppim"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/liviozanol" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Lívio Zanol Puppim</span></a></div><small class="avatar__subtitle" itemprop="description">Me</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_mojV" id="intro">Intro<a class="hash-link" href="#intro" title="Direct link to heading">​</a></h2><p>A long time ago (2006), When I was still graduating in computer science, I’ve made a <a href="https://www.youtube.com/watch?v=QsUlySdtqaw" target="_blank" rel="noopener noreferrer">video</a> showing the communication between 2 openBSD VMs configured with non-contiguous network masks (eg: 255.255.0.255 or 255.255.255.1) talking to each other.</p><p>At that time, I tried to use non-contiguous masks on Windows, Linux (Gentoo?), FreeBSD and OpenBSD. Only OpenBSD was able to make this kind of configuration.</p><p>Maybe having subnets with non-continuous masks aren&#x27;t useful at all, but what about firewalls/filters? Having this possibility can be good and suppress some (many?) lines of rules depending on your scenario.</p><p>The below video demonstrates a working environment using non-contiguous netmask on OpenBSD and also a working routing scenario between 2 subnets (one with EVEN IPs and one with ODDs IPs):</p><iframe width="600" height="400" src="https://www.youtube.com/embed/QsUlySdtqaw"></iframe><p>I&#x27;ve made this video after a conversation with some coleagues about general network fundamentals. At that time I was trying to figure out how to scan networks like this using NMAP and started a discussion at the mailing list (<a href="http://seclists.org/nmap-dev/2006/q4/50" target="_blank" rel="noopener noreferrer">http://seclists.org/nmap-dev/2006/q4/50</a>). Fortunately, nmap gives us some good options for this using wildcards. You can start a nmap scan with a range like <code>192.168.0-100.1</code> or <code>192.168.*.1</code> or even <code>192.168.0.1,3,5,7,9</code>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="the-fundamentals">The fundamentals<a class="hash-link" href="#the-fundamentals" title="Direct link to heading">​</a></h2><p>Network calculations are based on <a href="https://en.wikipedia.org/wiki/Bitwise_operation" target="_blank" rel="noopener noreferrer">bitwise operations</a>, and so are IP/mask 5-tuples filters/rules. If you want to know if an IP address belongs to an IP/subnet you can do an &quot;AND&quot; binary comparison using this IP and the subnet and compare the result with the intended IP and the same subnet. If the results are equal, they belong to the same subnet. (eg.: 192.168.0.1 AND 255.255.255.0 = 192.168.0.0, so is 192.168.0.250 AND 255.255.255.0). If you want to read a more complete calculation explanation you can <a href="https://www.prado.it/2016/05/21/.yet-another-post-about-ipv4-subnetting-non-contiguous-bits-version/" target="_blank" rel="noopener noreferrer">read this post</a></p><p>Since everything is bit afterall, why couldn&#x27;t we use non-contiguous netmasks? I don&#x27;t know exactly the reason. <a href="https://datatracker.ietf.org/doc/html/rfc950" target="_blank" rel="noopener noreferrer">RFC 950</a> doesn&#x27;t specify it as mandatory and also includes an explanation on its appendix with a non-contiguous example, but this old RFC was already &quot;overwritten&quot; by new ones that clearly stated that netmask bit <strong>must</strong> b contiguous. Maybe they wanted network configuration to be easier to understand?</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="checking-non-contiguous-subnet-mask-configuration-today">Checking non-contiguous Subnet Mask configuration Today<a class="hash-link" href="#checking-non-contiguous-subnet-mask-configuration-today" title="Direct link to heading">​</a></h2><p>I have made new tests on this subject, trying to configure an IP address with netmask 255.255.0.255 on some interface and the results are:</p><ul><li>FreeBSD 13.1: <strong>Supported</strong>! Didn&#x27;t work in 2006.</li><li>MAC OS: Didn&#x27;t test.</li><li>OpenBSD 7.1: <strong>Supported</strong>.</li><li>Ubuntu 22.04: Not supported. (either using iproute2 or ifconfig)</li><li>Windows 10: Not supported.</li></ul><p>I have tried to figure out why iproute2 on Ubuntu didn&#x27;t allow me to make this configuration by investigating the source code. I don&#x27;t know much about C and coded very little in it, so I find it difficult to understand some of the iproute2 code (and kernel too). Well, using the error message displayed <code>Error: any valid prefix is expected rather than &quot;192.168.0.1/255.255.0.255&quot;</code>, I was able to identify that this error is returned by function <a href="https://git.kernel.org/pub/scm/network/iproute2/iproute2.git/tree/lib/utils.c#n651" target="_blank" rel="noopener noreferrer">get_prefix_1</a>, more specific, inside get_prefix_1, it detected the error with the function <a href="https://git.kernel.org/pub/scm/network/iproute2/iproute2.git/tree/lib/utils.c#n164" target="_blank" rel="noopener noreferrer">get_netmask</a>. Reading the code below, I can suggest (but can&#x27;t be sure) that it tries to convert our dotted decimal mask to a CIDR and then returns an error.</p><div class="language-C codeBlockContainer_MPoW theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-C codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF codeBlockLinesWithNumbering_hGCP"><span class="token-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain">static int get_netmask(unsigned int *val, const char *arg, int base)</span></span></span><span class="token-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain">{</span></span></span><span class="token-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain">    inet_prefix addr;</span></span></span><span class="token-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain" style="display:inline-block"></span></span></span><span class="token-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain">    if (!get_unsigned(val, arg, base))</span></span></span><span class="token-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain">        return 0;</span></span></span><span class="token-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain" style="display:inline-block"></span></span></span><span class="token-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain">    /* try converting dotted quad to CIDR */</span></span></span><span class="token-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain">    if (!get_addr_1(&amp;addr, arg, AF_INET) &amp;&amp; addr.family == AF_INET) {</span></span></span><span class="token-line theme-code-block-highlighted-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain">        int b = mask2bits(addr.data[0]);</span></span></span><span class="token-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain" style="display:inline-block"></span></span></span><span class="token-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain">        if (b &gt;= 0) {</span></span></span><span class="token-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain">            *val = b;</span></span></span><span class="token-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain">            return 0;</span></span></span><span class="token-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain">        }</span></span></span><span class="token-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain">    }</span></span></span><span class="token-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain" style="display:inline-block"></span></span></span><span class="token-line theme-code-block-highlighted-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain">    return -1;</span></span></span><span class="token-line codeLine_rqGN" style="color:#F8F8F2"><span class="codeLineNumber_hzTh"></span><span class="codeLineContent_hM6e"><span class="token plain">}</span></span></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="packet-filters-and-firewalls">Packet filters and firewalls<a class="hash-link" href="#packet-filters-and-firewalls" title="Direct link to heading">​</a></h2><p>Ok, on FreeBSD and OpenBSD we can configure non-contiguous masks, but It isn&#x27;t very useful nowadays. But what about using it to filter packets on firewalls and ACLs? Well, in some scenarios it could be useful.</p><p>Imagine for example, you have a lot of remote WAN sites concentrating traffic on a central office on a typical hub-and-spoke topology and you have a well defined remote ip addressing police and every WAN site has a /24 subnet and a specific equipment (pbx/printer/proxy/router/whatever) is always the last IP. What if you want to allow traffic only from this IP from all sites on your central office, but block any other? In this case, on a typical implementation, you would have to create 1 /32 rule for each remote site.</p><p>Ex.:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#F8F8F2"><span class="token plain">permit ip 10.0.1.254/32 any</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">permit ip 10.0.2.254/32 any</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">permit ip 10.0.3.254/32 any</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">deny any any (implied)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you could use non-contiguous netmask you could solve this problem with only one line, like:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#F8F8F2"><span class="token plain">permit ip 10.0.0.254/255.255.0.255 any</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">deny any any (implied)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or using wildcard:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#F8F8F2"><span class="token plain">permit ip 10.0.0.254 0.0.255.0 any</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">deny any any (implied)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Do routers support this? What about firewalls? Tested some of them. These are the results (won&#x27;t put specific OS versions):</p><ul><li>IOS: Supported.</li><li>IOS XE: Supported.</li><li>IOS XR: Supported.</li><li>NX OS: Supported.</li><li>Huawei VRP: Supported.</li><li>Windows O.S. Firewall: <strong>Not Supported</strong>.</li><li>IPtables: Supported.</li><li>PF: Didn&#x27;t test. <a href="https://man.openbsd.org/pf.conf" target="_blank" rel="noopener noreferrer">Documentation</a> specify CIDR notation or ranges.</li></ul><p>Nice! Almost every equipment/firewall supports it! So yes, you can use this to make a more intelligent filter, just don&#x27;t forget that other people may be reading and managing the equipment/software with you, they must be notified about it, since reading this kind of configuration for the first time can be confusing.</p><p>Also, as a side note, since IPtables support this kind of rule, and docker and kubernetes relies on it, I think you could mock a sort of non-contiguous netmask configuration on it. But please, don&#x27;t.</p><p>Another point to note is that <a href="https://github.com/xdp-project/xdp-tutorial" target="_blank" rel="noopener noreferrer">eBPF XDP</a> has been rising as a solution for simple filters and firewalls. Being <em>very</em> basic on the definition, XDP lets you execute a user-built program for every packet that arrives on an interface so you can decide whatever you want to do with it. So for sure it can support non-contiguous masks. Maybe in the future, I can write more about XDP.</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_h6_j"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/network-fundamentals">network fundamentals</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/subnet">subnet</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/iptables">iptables</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/acl">acl</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/routing">routing</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/pf">pf</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/liviozanol/liviozanol.github.io/blog/2022-05-20-non-contiguous-netmask/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/vmware-vds-traffic-filter"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Using vSphere Distributed Switch (VDS) for stateless &quot;traffic filtering&quot; (or ACL)</div></a></nav></main><div class="col col--2"><div class="tableOfContents_cNA8 thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#intro" class="table-of-contents__link toc-highlight">Intro</a></li><li><a href="#the-fundamentals" class="table-of-contents__link toc-highlight">The fundamentals</a></li><li><a href="#checking-non-contiguous-subnet-mask-configuration-today" class="table-of-contents__link toc-highlight">Checking non-contiguous Subnet Mask configuration Today</a></li><li><a href="#packet-filters-and-firewalls" class="table-of-contents__link toc-highlight">Packet filters and firewalls</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Livio Zanol Puppim (livio@zanol.com.br). Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.fd840988.js"></script>
<script src="/assets/js/main.75488faf.js"></script>
</body>
</html>
<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Livio&#39;s Dump RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Livio&#39;s Dump Atom Feed"><title data-react-helmet="true">Full-Stack Automation Part 8 - Demo - Runner | Livio&#x27;s Dump</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://liviozanol.github.io./full-stack-it-automation-part-8-demo-gitlab-runner"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Full-Stack Automation Part 8 - Demo - Runner | Livio&#x27;s Dump"><meta data-react-helmet="true" name="description" content="Gtilab-CI/Gitlab Runner"><meta data-react-helmet="true" property="og:description" content="Gtilab-CI/Gitlab Runner"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2022-01-18T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/liviozanol"><meta data-react-helmet="true" property="article:tag" content="automation,awx,ansible,gitlab,network automation,gitlab-ci,CI/CD,gitops"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://liviozanol.github.io./full-stack-it-automation-part-8-demo-gitlab-runner"><link data-react-helmet="true" rel="alternate" href="https://liviozanol.github.io./full-stack-it-automation-part-8-demo-gitlab-runner" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://liviozanol.github.io./full-stack-it-automation-part-8-demo-gitlab-runner" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.72c6fd0a.css">
<link rel="preload" href="/assets/js/runtime~main.df9db110.js" as="script">
<link rel="preload" href="/assets/js/main.c157b536.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/lzp-small.svg" alt="Logo" class="themedImage_TMUO themedImage--light_4Vu1" height="32" width="32"><img src="/img/lzp-small.svg" alt="Logo" class="themedImage_TMUO themedImage--dark_uzRr" height="32" width="32"></div><b class="navbar__title">Livio&#x27;s Dump</b></a><a href="https://github.com/liviozanol" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="mailto:livio@zanol.com.br" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>E-mail: livio@zanol.com.br<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">All posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/full-stack-it-automation-part-10-demo-ui">Full-Stack Automation Part 10 - Demo - UI</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/full-stack-it-automation-part-9-demo-api">Full-Stack Automation Part 9 - Demo - API</a></li><li class="sidebarItem_cjdF"><a aria-current="page" class="sidebarItemLink_zyXk sidebarItemLinkActive_wcJs" href="/full-stack-it-automation-part-8-demo-gitlab-runner">Full-Stack Automation Part 8 - Demo - Runner</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/full-stack-it-automation-part-7-demo-awx">Full-Stack Automation Part 7 - Demo - AWX</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/full-stack-it-automation-part-6-demo-scenario">Full-Stack Automation Part 6 - Demo -Scenario</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/full-stack-it-automation-part-5-gitlabci">Full-Stack Automation Part 5 - Gitlab CI</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/full-stack-it-automation-part-4-awx">Full-Stack Automation Part 4 - AWX</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/full-stack-it-automation-part-3-Vault">Full-Stack Automation Part 3 - Vault</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/full-stack-it-automation-part-2-gitlab">Full-Stack Automation Part 2 - Gitlab</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/full-stack-it-automation-part-1">Full-Stack Automation Part 1 - Overview</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/first">First Post</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">Full-Stack Automation Part 8 - Demo - Runner</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2022-01-18T00:00:00.000Z" itemprop="datePublished">January 18, 2022</time> Â· <!-- -->6 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/liviozanol" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://github.com/liviozanol.png" alt="LÃ­vio Zanol Puppim"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/liviozanol" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">LÃ­vio Zanol Puppim</span></a></div><small class="avatar__subtitle" itemprop="description">Me</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_y2LR" id="gtilab-cigitlab-runner">Gtilab-CI/Gitlab Runner<a aria-hidden="true" class="hash-link" href="#gtilab-cigitlab-runner" title="Direct link to heading">â€‹</a></h2><p>In the previous post we have defined our structured data, stored it on gitlab, created our playbooks and inventories and imported them on AWX. Now we will prepare our CI/CD pipeline to monitor changes on our data on gitlab and tell AWX to execute our playbook. Gitlab runner will be responsible for these tasks, registering on our gitlab projects/group and executing a series of tasks once our data is changed, calling AWX API to run our workflow playbook passing our modified data and monitoring our job in execution also using AWX API.</p><p>All files generated on this section (and on previous) are on full-stack automation github repo (<a href="https://github.com/liviozanol/full-stack-automation" target="_blank" rel="noopener noreferrer">https://github.com/liviozanol/full-stack-automation</a>), so you don&#x27;t need to create it yourself again.</p><p>Everytime our gitlab repository is changed, gitlab-ci will get the contents of our wan_site_cfg.json file and send it to AWX as a variable, calling a job/playbook/template or a workflow that will implement the changes on our equipments.</p><p>After concluding this section you will have something like a GitOps for our wan automation service. If you change some information from your WAN site on gitlab repo, AWX will implement it on equipment.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Please, note that in this demo we installed gitlab runner using &quot;privileged&quot; mode and also mapped docker host socket to the container. This means that gitlab runner container can virtually execute any docker command directly into our docker host, stopping, starting, running and removing ANY container (including AWX and itself). This is NOT a good practice, but we have made this way because we will use gitlab runner to also start our APIs and UI container on the demo.</p><p>In a production environment, as stated before, its a good practice to separate functions on different hosts (user APIs, UI and its gitlab runner CI/CD on a isolated place from AWX playbooks and its own gitlab runner CI/CD) and if possible creating/using more than one gitlab. The gitlab runner that starts our AWX jobs, does not need privileged access and only needs to connect to AWX and gitlab APIs, so you don&#x27;t need to map docker host socket neither use privileged mode on this runner and could use <a href="https://github.com/jpetazzo/dind" target="_blank" rel="noopener noreferrer">docker in docker</a> to run your curl/bash commands or execute commands directly on gitlab runner container.</p></div></div><p>Every file for Gitlab Runner config to our demo can be found <a href="https://github.com/liviozanol/full-stack_automation/tree/master/demo/gitlab-ci" target="_blank" rel="noopener noreferrer">here</a></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="registering-our-runner">Registering our runner<a aria-hidden="true" class="hash-link" href="#registering-our-runner" title="Direct link to heading">â€‹</a></h2><p>To register our gitlab-CI/runner we first need a registration token and we will get this token using gitlab API. After getting this token we will <code>docker exec</code> a command on gitlab runner container to register it on the wan_site group. After runner is registered, everytime a file is changed on any repository inside wan_site group, gitlab runner will look for a .gitlab-ci.yml file and use it to start our CI/CD pipeline.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="building-our-gitlab-ciyml">Building our .gitlab-ci.yml<a aria-hidden="true" class="hash-link" href="#building-our-gitlab-ciyml" title="Direct link to heading">â€‹</a></h2><p>Will be used a quite simple pipeline with only 1 stage that gets required credentials from our Vault 2 and calls AWX API to start our workflow job template and monitors it until it stops. You could insert other stages to improve your pipeline and you should consider this if you are making more complex automations. Some examples for network automation:</p><ul><li>Add a <a href="https://vincent.bernat.ch/en/blog/2021-network-jerikan-ansible" target="_blank" rel="noopener noreferrer">Jerikan</a> stage to to parse your data and send it already parsed to AWX (needs to change the playbook)</li><li>Add a <a href="https://www.batfish.org/" target="_blank" rel="noopener noreferrer">batfish</a> stage to validate your config after parsing it.</li><li>Add a <a href="https://netsim-tools.readthedocs.io/" target="_blank" rel="noopener noreferrer">network simulation tool</a> stage to test your parsed configs in a lab.</li><li>Add a &quot;homologation&quot; test stage, running another playbook (or changing hostname or sending to another specific AWX) that will implement your changes on some lab equipment and validate its functionalities. Could either be physical equipments or lab routers running on a qemu emulation (see <a href="https://www.eve-ng.net/" target="_blank" rel="noopener noreferrer">eve-ng</a> for a nice solution)</li><li>Add an approval stage making the pipeline wait until an operator access gitlab and approves the changes (or build an API/UI for this step!).</li></ul><p>Our 1 stage pipeline will use a basic alpine image from docker hub and we will install curl and jq on it to use on our APIs calls. You could (and I think it&#x27;s a good practice) build your own image only with basic Shell functionalities, curl, jq and other tools that you use on each stage.</p><p>To query Vault and get AWX user/pass we need a token and we&#x27;ll store it using the gitlab variable as &#x27;masked&#x27;. It&#x27;s the only presumably sensible information that will be stored on gitlab. Any other sensitive data that will be needed must be stored on Vault and queried from it on run time. You should restrict the access to this access token and for AWX user/pass on hashicorp Vault to only allow queries from gitlab ip address, but we won&#x27;t do this on the demo. If you are on a production environment I hope you built Vault and installed it already on an isolated environment with restricted L3/L4 access and will also make the application restriction mentioned. </p><p>We will also use 2 more variables on gitlab: Vault URL and AWX IP Address/Port. You could store the AWX ip/port on Vault if you want...</p><p>After getting the AWX credentials, our pipeline will call AWX API to run our playbook, getting the modified data from wan_site_data.json on the repository and simply passing it as an extra_vars to AWX.</p><p>At the end we have a simple while loop that keeps querying the AWX API to get the job status and either exit 0 (if the job is successful) or 1 (if it fails).</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yml"><pre tabindex="0" class="prism-code language-yml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> alpine</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">3.15.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">before_script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#Installing curl and jq</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> which curl </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> (apk </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">no</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cache add curl)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> which jq </span><span class="token punctuation" style="color:#393A34">|</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> (apk </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">no</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cache add jq)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> PLAYBOOK_NAME=&quot;wan_automation_workflow_template&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#Getting credentials from vault</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CURL_RESULT=`curl -sk -H \&quot;X-Vault-Token: $VAULT_TWO_TOKEN\&quot; \&quot;$VAULT_TWO_URL/v1/secret/data/awx_secret\&quot;`&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;AWX_USER=`echo $CURL_RESULT | jq -r .data.data.awx_user`&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;AWX_PASS=`echo $CURL_RESULT | jq -r .data.data.awx_pass`&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> AWX_URL=&quot;https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//$AWX_USER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">$AWX_PASS@$AWX_ADDRESS_PORT&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#Querying AWX API to get workflow job template ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;JOB_TEMPLATE_ID=`curl -sk $AWX_URL/api/v2/workflow_job_templates/?search=$PLAYBOOK_NAME | jq .results[].id`&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#Calling AWX API to run our workflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;JOB_ID=`curl --header \&quot;Content-Type: application/json\&quot; -sk $AWX_URL/api/v2/workflow_job_templates/$JOB_TEMPLATE_ID/launch/ --data \&quot;{\\\&quot;extra_vars\\\&quot;:$(cat wan_site_data.json)}\&quot; | jq .id`&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#Monitoring workflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#COUNT is used as a protection so we don&#x27;t have ifnite loops</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> COUNT=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> MAX_COUNT=80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      while true; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        JOB_STATUS_TEXT=`curl -sk $AWX_URL/api/v2/workflow_jobs/$JOB_ID/ | jq -r .status`</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        if [ &quot;$JOB_STATUS_TEXT&quot; == &quot;successful&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          exit 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        if [ &quot;$JOB_STATUS_TEXT&quot; == &quot;failed&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        sleep 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        COUNT=$(( COUNT + 1 ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        if [ &quot;$COUNT&quot; -gt &quot;$MAX_COUNT&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          echo &quot;protection against infinite loop reached. aborting&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      done;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/automation">automation</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/awx">awx</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/ansible">ansible</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/gitlab">gitlab</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/network-automation">network automation</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/gitlab-ci">gitlab-ci</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/ci-cd">CI/CD</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/tags/gitops">gitops</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/liviozanol/liviozanol.github.io/blog/2022-01-18-automation-8/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/full-stack-it-automation-part-9-demo-api"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« <!-- -->Full-Stack Automation Part 9 - Demo - API</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/full-stack-it-automation-part-7-demo-awx"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Full-Stack Automation Part 7 - Demo - AWX<!-- --> Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#gtilab-cigitlab-runner" class="table-of-contents__link toc-highlight">Gtilab-CI/Gitlab Runner</a></li><li><a href="#registering-our-runner" class="table-of-contents__link toc-highlight">Registering our runner</a></li><li><a href="#building-our-gitlab-ciyml" class="table-of-contents__link toc-highlight">Building our .gitlab-ci.yml</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Livio Zanol Puppim (livio@zanol.com.br). Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.df9db110.js"></script>
<script src="/assets/js/main.c157b536.js"></script>
</body>
</html>